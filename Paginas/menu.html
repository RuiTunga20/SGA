{% load static %}
<link rel="stylesheet" href="{% static 'css/main.css' %}">
<link rel="stylesheet" href="{% static 'css/toastify.min.css' %}">
<script src="{% static 'js/toastify.min.js' %}"></script>
    <header class="header">
        <div class="header-content">
            <div class="logo-area">
                <a href="{% url 'Painel' %}"><div class="logo">sigap<span class="orange-text">.gov.ao</span></div></a>
                
                {% if user.is_authenticated %}
                    <div class="dept-header-label">
                        {% if user.departamento %}
                            {{ user.departamento.nome }}
                        {% elif user.seccao %}
                            {{ user.seccao.nome }}
                        {% endif %}
                    </div>
                {% endif %}
            </div>

            {% if user.is_authenticated and user.administracao %}
                <div class="admin-header-label">
                            {% if user.is_staff %}
                                <a href="/Painel-Control/" title="Painel Administrativo">{{ user.username }}</a>
                            {% else %}
                                <span>{{ user.username }}</span>
                            {% endif %}
                       -
                         {% if user.nivel_acesso == 'admin_sistema' %}
                            <a href="{% url 'gestao_usuarios' %}" title="GestÃ£o de UsuÃ¡rios" style="text-decoration: underline;">{{ user.administracao.nome }}</a>
                         {% else %}
                            {{ user.administracao.nome }}
                         {% endif %}
                         <br>
                    
                </div>
            {% endif %}
            <div class="header-right">
                <nav class="main-nav" id="main-nav">
                    <ul>
                        <li><a href="{% url 'criar_documento' %}">Registo de Entrada</a></li>
                        <li><a href="{% url 'listar_documentos' %}">Expedientes</a></li>
                        <li><a href="{% url 'pendencias' %}">Pendentes</a></li>
                        <li><a href="{% url 'arquivo_morto' %}">Arquivo Morto</a></li>
                        <li><a href="{% url 'listar_armazenamentos' %}">Armazenamento</a></li>
                        <li><a href="{% url 'logout' %}" class="">Sair</a></li>


                    </ul>
                </nav>
                <div class="header-actions">
                    {% if user.is_authenticated %}
                       
                        <div class="notification-bell" id="notificationBell">
                            <span>ðŸ””</span>
                            {% if unread_notifications_count > 0 %}
                                <div class="notification-count" id="notificationCount">{{ unread_notifications_count }}</div>
                            {% endif %}
                            <div class="notifications-dropdown" id="notificationsDropdown">
                                <div style="padding: 1rem; font-weight: bold; border-bottom: 1px solid #eee;">NotificaÃ§Ãµes</div>
                                {% for notification in recent_notifications %}
                                    <div class="notification-item {% if not notification.lida %}unread{% endif %}">
                                        <a href="{{ notification.link }}">
                                            {{ notification.mensagem }}
                                            <small style="display: block; color: #999; margin-top: 5px;">{{ notification.data_criacao|timesince }} atrÃ¡s</small>
                                        </a>
                                    </div>
                                {% empty %}
                                    <div style="padding: 1rem; text-align: center;">Nenhuma notificaÃ§Ã£o.</div>
                                {% endfor %}
                            </div>
                        </div>
                    {% else %}
                        <a href="#" class="btn-header btn-login">Entrar</a>
                    {% endif %}
                    <div class="menu-icons">
                        <button class="hamburger-menu" id="hamburger-menu" aria-label="Menu">
                            <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </header>



    {% if messages %}
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            {% for message in messages %}
                Toastify({
                    text: "{{ message }}",
                    duration: 5000,
                    gravity: "top", 
                    position: "right", 
                    className: "toast-{{ message.tags }}",
                    stopOnFocus: true,
                    style: {
                        background: "{% if message.tags == 'error' %}#ef4444{% elif message.tags == 'success' %}#22c55e{% elif message.tags == 'warning' %}#f59e0b{% else %}#3b82f6{% endif %}",
                    }
                }).showToast();
            {% endfor %}
        });
    </script>
    {% endif %}

    <script>
        window.SGA_CONFIG = {
            csrfToken: '{{ csrf_token }}',
            markReadUrl: "{% url 'marcar_notificacoes_lidas' %}",
            checkNotificationsUrl: "{% url 'verificar_notificacoes' %}",
            wsUrl: (window.location.protocol === 'https:' ? 'wss:' : 'ws:') + '//' + window.location.host + '/ws/notificacoes/',
            isAuthenticated: {{ user.is_authenticated|yesno:"true,false" }}
        };
    </script>
    <script src="{% static 'js/main.js' %}"></script>
    <script src="{% static 'js/notifications.js' %}"></script>