<!DOCTYPE html>
<html lang="pt-BR" class="h-full bg-slate-50">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% if form.instance.pk %}Editar Documento{% else %}Novo Documento{% endif %} - SGA Aurora</title>
    <!-- Select2 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
</head>
<body class="h-full">
    {% include "menu.html" %}

    <main class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-10">
        
        <!-- Header da Página -->
        <div class="mb-8 overflow-hidden">
            <div class="flex items-center gap-3 mb-2">
                <a href="{% url 'listar_documentos' %}" class="p-2 text-slate-400 hover:text-sga-red hover:bg-red-50 rounded-lg transition-all">
                    <i data-lucide="arrow-left" class="w-5 h-5"></i>
                </a>
                <h2 class="text-3xl font-extrabold text-slate-800 tracking-tight font-display">
                    {% if form.instance.pk %}Editar Expediente{% else %}Novo Registro{% endif %}
                </h2>
            </div>
            <p class="text-slate-500 font-medium text-sm ml-12">
                Preencha as informações abaixo para realizar o registro oficial do documento no sistema.
            </p>
        </div>

        <form method="post" enctype="multipart/form-data" class="space-y-6">
            {% csrf_token %}

            <!-- Seção 1: Identificação do Documento -->
            <div class="bg-white rounded-2xl shadow-sm border border-slate-100 overflow-hidden">
                <div class="px-6 py-4 border-b border-slate-50 bg-slate-50/50 flex items-center gap-2">
                    <i data-lucide="file-text" class="w-4 h-4 text-sga-blue"></i>
                    <h3 class="text-xs font-black uppercase tracking-widest text-slate-500">Identificação do Expediente</h3>
                </div>
                <div class="p-6 grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="space-y-1.5 focus-within:text-sga-red transition-colors">
                        <label for="id_tipo_documento" class="text-xs font-bold text-slate-600 block mb-1 uppercase tracking-wider">Tipo de Documento</label>
                        {{ form.tipo_documento }}
                    </div>
                    <div class="space-y-1.5 focus-within:text-sga-red transition-colors">
                        <label for="id_referencia" class="text-xs font-bold text-slate-600 block mb-1 uppercase tracking-wider">Referência / Cotação</label>
                        {{ form.referencia }}
                    </div>
                    <div class="md:col-span-2 space-y-1.5 focus-within:text-sga-red transition-colors">
                        <label for="id_titulo" class="text-xs font-bold text-slate-600 block mb-1 uppercase tracking-wider">Assunto Principal</label>
                        {{ form.titulo }}
                    </div>
                </div>
            </div>

            <!-- Seção 2: Origem e Remetente -->
            <div class="bg-white rounded-2xl shadow-sm border border-slate-100 overflow-hidden">
                <div class="px-6 py-4 border-b border-slate-50 bg-slate-50/50 flex items-center gap-2">
                    <i data-lucide="user" class="w-4 h-4 text-sga-red"></i>
                    <h3 class="text-xs font-black uppercase tracking-widest text-slate-500">Origem e Remetente</h3>
                </div>
                <div class="p-6 grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="space-y-1.5 focus-within:text-sga-red transition-colors">
                        <label for="id_origem" class="text-xs font-bold text-slate-600 block mb-1 uppercase tracking-wider">Departamento / Entidade de Origem</label>
                        {{ form.origem }}
                    </div>
                    <div class="space-y-1.5 focus-within:text-sga-red transition-colors">
                        <label for="id_utente" class="text-xs font-bold text-slate-600 block mb-1 uppercase tracking-wider">Nome do Remetente / Utente</label>
                        {{ form.utente }}
                    </div>
                    <div class="space-y-1.5 focus-within:text-sga-red transition-colors">
                        <label for="id_telefone" class="text-xs font-bold text-slate-600 block mb-1 uppercase tracking-wider">Telefone de Contacto</label>
                        {{ form.telefone }}
                    </div>
                    <div class="space-y-1.5 focus-within:text-sga-red transition-colors">
                        <label for="id_email" class="text-xs font-bold text-slate-600 block mb-1 uppercase tracking-wider">E-mail Institucional</label>
                        {{ form.email }}
                    </div>
                </div>
            </div>

            <!-- Seção 3: Prioridade e Acesso -->
            <div class="bg-white rounded-2xl shadow-sm border border-slate-100 overflow-hidden">
                <div class="px-6 py-4 border-b border-slate-50 bg-slate-50/50 flex items-center gap-2">
                    <i data-lucide="shield" class="w-4 h-4 text-amber-500"></i>
                    <h3 class="text-xs font-black uppercase tracking-widest text-slate-500">Prioridade e Níveis de Acesso</h3>
                </div>
                <div class="p-6 grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="space-y-1.5 focus-within:text-sga-red transition-colors">
                        <label for="id_prioridade" class="text-xs font-bold text-slate-600 block mb-1 uppercase tracking-wider">Grau de Prioridade</label>
                        {{ form.prioridade }}
                    </div>
                    <div class="space-y-1.5 focus-within:text-sga-red transition-colors">
                        <label for="id_niveis" class="text-xs font-bold text-slate-600 block mb-1 uppercase tracking-wider">Visibilidade / Sigilo</label>
                        {{ form.niveis }}
                    </div>
                </div>
            </div>

            <!-- Seção 4: Documentos Anexos -->
            <div class="bg-white rounded-2xl shadow-sm border border-slate-100 overflow-hidden">
                <div class="px-6 py-4 border-b border-slate-50 bg-slate-50/50 flex items-center gap-2">
                    <i data-lucide="paperclip" class="w-4 h-4 text-emerald-500"></i>
                    <h3 class="text-xs font-black uppercase tracking-widest text-slate-500">Documentos Anexos (PDF)</h3>
                </div>
                <div class="p-6 grid grid-cols-1 md:grid-cols-2 gap-8">
                    <!-- Arquivo Principal -->
                    <div class="space-y-4">
                        <div class="flex items-center justify-between mb-1">
                            <label class="text-xs font-bold text-slate-600 uppercase tracking-wider">Arquivo Principal</label>
                            {% if form.instance.arquivo %}
                                <a href="{{ form.instance.arquivo.url }}" target="_blank" class="text-[10px] font-bold text-sga-blue flex items-center gap-1 hover:underline">
                                    <i data-lucide="external-link" class="w-3 h-3"></i> Atual
                                </a>
                            {% endif %}
                        </div>
                        <div class="relative group">
                            <label class="flex flex-col items-center justify-center w-full h-32 border-2 border-dashed border-slate-200 rounded-xl hover:border-sga-blue hover:bg-blue-50 transition-all cursor-pointer bg-slate-50">
                                <div class="flex flex-col items-center justify-center pt-5 pb-6">
                                    <i data-lucide="upload-cloud" class="w-8 h-8 text-slate-400 group-hover:text-sga-blue transition-colors mb-2"></i>
                                    <p class="text-xs text-slate-500 group-hover:text-sga-dark transition-colors font-medium">Carregar PDF Original</p>
                                </div>
                                {{ form.arquivo }}
                            </label>
                        </div>
                    </div>

                    <!-- Arquivo Digitalizado -->
                    <div class="space-y-4">
                         <div class="flex items-center justify-between mb-1">
                            <label class="text-xs font-bold text-slate-600 uppercase tracking-wider">Arquivo Digitalizado (Opcional)</label>
                            {% if form.instance.arquivo_digitalizado %}
                                <a href="{{ form.instance.arquivo_digitalizado.url }}" target="_blank" class="text-[10px] font-bold text-sga-blue flex items-center gap-1 hover:underline">
                                    <i data-lucide="external-link" class="w-3 h-3"></i> Atual
                                </a>
                            {% endif %}
                        </div>
                        <div class="relative group">
                            <label class="flex flex-col items-center justify-center w-full h-32 border-2 border-dashed border-slate-200 rounded-xl hover:border-sga-red hover:bg-red-50 transition-all cursor-pointer bg-slate-50">
                                <div class="flex flex-col items-center justify-center pt-5 pb-6">
                                    <i data-lucide="scan" class="w-8 h-8 text-slate-400 group-hover:text-sga-red transition-colors mb-2"></i>
                                    <p class="text-xs text-slate-500 group-hover:text-sga-dark transition-colors font-medium">Anexar Digitalização</p>
                                </div>
                                {{ form.arquivo_digitalizado }}
                            </label>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Ações Finais -->
            <div class="flex items-center justify-end gap-3 pt-4 border-t border-slate-200">
                <a href="{% url 'listar_documentos' %}" class="px-6 py-2.5 rounded-xl text-sm font-bold text-slate-500 hover:bg-slate-100 transition-all">
                    Cancelar
                </a>
                <button type="submit" class="inline-flex items-center gap-2 px-8 py-2.5 bg-sga-red hover:bg-red-700 text-white rounded-xl font-bold text-sm shadow-xl shadow-red-100 transition-all hover:-translate-y-0.5 active:translate-y-0">
                    <i data-lucide="save" class="w-4 h-4"></i>
                    {% if form.instance.pk %}Atualizar Registro{% else %}Confirmar Registro{% endif %}
                </button>
            </div>
        </form>
    </main>

    <!-- Footer scripts -->
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Inicializar ícones
            if (window.lucide) {
                lucide.createIcons();
            }

            // Estilizar inputs via JS para manter compatibilidade com Django Forms
            document.querySelectorAll('input:not([type="file"]):not([type="hidden"]), select, textarea').forEach(el => {
                if (!el.classList.contains('select2-hidden-accessible')) {
                    el.className = "block w-full px-4 py-2.5 bg-slate-50 border-transparent focus:bg-white focus:ring-2 focus:ring-sga-red/20 focus:border-sga-red rounded-xl text-sm font-medium transition-all outline-none";
                }
            });

            // Estilizar inputs de arquivo
            document.querySelectorAll('input[type="file"]').forEach(input => {
                input.className = "hidden";
                input.addEventListener('change', function(e) {
                    const fileName = e.target.files[0]?.name;
                    const label = this.parentElement.querySelector('p');
                    if (fileName && label) {
                        label.textContent = fileName;
                        label.className = "text-xs text-sga-red font-bold";
                    }
                });
            });

            // Ativar Select2 com tema customizado
            $(document).ready(function() {
                $('select').select2({
                    placeholder: 'Selecione uma opção...',
                    width: '100%',
                    containerCssClass: 'sga-select2-container'
                });
                
                // Aplicar estilos SGA à estrutura do Select2 via CSS injetado
                const style = document.createElement('style');
                style.innerHTML = `
                    .select2-container--default .select2-selection--single {
                        background-color: #f8fafc;
                        border: 2px solid transparent;
                        border-radius: 12px;
                        height: 44px;
                        padding: 6px 12px;
                        transition: all 0.2s;
                    }
                    .select2-container--default.select2-container--focus .select2-selection--single {
                        background-color: white;
                        border-color: #c8102e;
                        box-shadow: 0 0 0 4px rgba(200, 16, 46, 0.1);
                    }
                    .select2-container--default .select2-selection--single .select2-selection__rendered {
                        color: #1e293b;
                        font-family: inherit;
                        font-weight: 500;
                        font-size: 0.875rem;
                        line-height: normal;
                        padding-left: 0;
                    }
                    .select2-container--default .select2-selection--single .select2-selection__arrow {
                        height: 40px;
                        right: 10px;
                    }
                    .select2-dropdown {
                        border: none;
                        border-radius: 12px;
                        box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
                        margin-top: 5px;
                        padding: 4px;
                    }
                    .select2-search--dropdown .select2-search__field {
                        background-color: #f1f5f9;
                        border: none;
                        border-radius: 8px;
                        padding: 8px 12px;
                    }
                    .select2-results__option {
                        border-radius: 6px;
                        padding: 8px 12px;
                        font-size: 0.875rem;
                        font-weight: 500;
                        color: #475569;
                    }
                    .select2-results__option--highlighted[aria-selected] {
                        background-color: #fef2f2 !important;
                        color: #c8102e !important;
                    }
                `;
                document.head.appendChild(style);
            });
        });
    </script>
</body>
</html>